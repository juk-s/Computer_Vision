# ЛР2: трекинг объекта по ключевым точкам

## Цель
Отследить положение объекта на видео с помощью ключевых точек и гомографии и оформить отчёт.

## Теоретическая база
- ORB и AKAZE находят ключевые точки и бинарные дескрипторы.
- BFMatcher с ratio test (Лоу) отбирает устойчивые соответствия между шаблоном и кадром.
- Гомография (RANSAC) оценивает проективное преобразование и отбрасывает выбросы; проецирование углов шаблона даёт рамку объекта.
- Масштаб и освещение компенсируются многоуровневой пирамидой детектора, явным масштабированием кадров и CLAHE.

## Описание системы
- Первый кадр видео берётся как шаблон объекта.
- Для шаблона вычисляются дескрипторы ORB и AKAZE; на каждом кадре считаются те же признаки.
- Для нескольких масштабов кадра строятся соответствия, затем гомография; если инлайеров хватает, рисуется рамка и подпись.
- Если совпадений нет, выводится `Object not found`.
- Для дальних кадров включён CLAHE; параметры детектора увеличены (`nfeatures`, `nlevels`) и добавлено явное масштабирование `scales`.

## Запуск
1. Зависимости: `pip install opencv-python numpy`.
2. Откройте `t2.ipynb` и выполните ячейки. Пример вызова:
   ```python
   track_object("mona-lisa.avi", "results/test_mona_lisa.mp4")
   ```
3. Для своих видео: первый кадр должен содержать объект крупно; задайте путь к входному видео и выходу в `results/`.

## Результаты и тестирование
- Прогоните алгоритм минимум на трёх тестовых роликах и одном своём, сложите выходные mp4 в `results/`.
- Проверяйте, удерживается ли рамка при изменении масштаба, угла и освещения; при необходимости подстройте `scales`, `ratio`, `min_inliers`.
- При большом расстоянии помогает увеличенный список `scales` и включённый CLAHE.

## Выводы
Метод устойчив к масштабу и перспективе на текстурированных объектах благодаря дескрипторам и RANSAC, но чувствителен к слабой текстуре и сильному блюру.

## Источники
- OpenCV docs: Feature Detection/Description, BFMatcher, Homography + RANSAC.
- D. Lowe. Distinctive Image Features from Scale-Invariant Keypoints.
- OpenCV tutorials по ORB, AKAZE и сопоставлению дескрипторов.
# ЛР2: трекинг объекта по ключевым точкам

Цель: реализовать простой трекер, который по первому кадру (крупный план объекта) находит этот объект на последующих кадрах и рисует рамку с подписью.

В репозитории два варианта:
- `t2.ipynb` — базовая версия (ORB/AKAZE, масштабирование кадра).
- `t3.ipynb` — упрощённый код, но с пирамидой шаблонов и кадра, чтобы лучше ловить объект на расстоянии.

## Теоретическая база
- Ключевые точки и дескрипторы: ORB (ориентированные FAST + BRIEF) и AKAZE; дают устойчивые к масштабу/повороту признаки.
- Сопоставление дескрипторов: `BFMatcher` + ratio test (Лоу) для отсечения ложных совпадений.
- Проективное преобразование: гомография по RANSAC оставляет инлиеры и отбрасывает выбросы.
- Контраст: CLAHE поднимает текстуру на тёмных/размытых кадрах.
- Масштабы: пирамида кадра и уменьшенные копии шаблона компенсируют изменение размера объекта.

## Описание разработанной системы
- Шаблон берётся из первого кадра видео (ожидается крупное изображение объекта).
- Предобработка: перевод в градации серого, по желанию CLAHE.
- Детектор: ORB с большим количеством уровней и низким порогом, чтобы находить точки даже на дальних планах.
- Поиск в кадре: строится несколько масштабов кадра (0.8–3.0) и несколько уменьшений шаблона (1.0–0.4 в `t3`). Для каждой пары масштабов ищутся соответствия дескрипторов, применяется ratio test, пороги по количеству совпадений и инлиерам.
- Построение рамки: по гомографии углы шаблона переносятся в координаты кадра; если ничего не найдено, выводится «Object not found».
- Вывод: результат сохраняется в `results/*.mp4`.

## Результаты работы и тестирования
- `mona-lisa.avi`: оба блокнота находят объект; версия `t3` держит рамку на более дальних кадрах благодаря дополнительным масштабам и CLAHE.
- Собственные видео: положите файл в корень проекта и вызовите в `t3.ipynb` что-то вроде  
  ```python
  track_object("my_video.mp4", "results/my_video_out.mp4")
  ```
- Скрипты пишут результат в папку `results/`; промежуточных файлов не создаётся.

## Выводы
- Подход по ключевым точкам прост в настройке и не требует обучения под конкретный объект.
- Масштабная пирамида (и кадра, и шаблона) плюс CLAHE заметно повышают устойчивость при уменьшении объекта.
- Ограничения: сильное размытие, однотонные объекты и большие повороты/деформации ухудшают трекинг.

## Запуск
- Установите зависимости: `pip install opencv-python numpy`.
- Откройте `t3.ipynb`, выполните ячейки и вызовите `track_object(...)` с путями к видео и выходному mp4.
- Для сравнения можно запустить `t2.ipynb` с теми же путями.

## Использованные источники
- OpenCV docs: Feature Detection/Description, BFMatcher, Homography + RANSAC, CLAHE.
- D. Lowe. Distinctive Image Features from Scale-Invariant Keypoints.
- Официальные примеры OpenCV по ORB/AKAZE и построению гомографии.
